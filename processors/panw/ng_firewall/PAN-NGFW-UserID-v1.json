{"name":"PAN-NGFW-UserID-v1","config":{"Name":"lua","match":"*","code":"cb_filter=require('calyptia.pr')([====================[[{\"type\":\"parse\",\"opts\":{\"src\":\"log\",\"dst\":\"parsed\",\"regex\":\"^(?<future_user>[^,]+),(?<receive_time>[^,]+),(?<serial_number>[^,]+),(?<type>USERID),(?<content_type>[^,]+),(?<future_use>[^,]+),(?<generated_time>[^,]+),(?<virtual_system>[^,]+),(?<source_ip>[^,]+),(?<user>[^,]+),(?<data_source_name>[^,]*),(?<event_id>[^,]+),(?<repeat_count>[^,]+),(?<time_out_threshold>[^,]+),(?<source_port>[^,]+),(?<destination_port>[^,]+),(?<data_source>[^,]+),(?<data_source_type>[^,]+),(?<sequence_number>[^,]+),(?<action_flags>[^,]+),(?<device_group_hierarchy_level_1>[^,]+),(?<device_group_hierarchy_level_2>[^,]+),(?<device_group_hierarchy_level_3>[^,]+),(?<device_group_hierarchy_level_4>[^,]+),(?<virtual_system_name>[^,]*),(?<device_name>[^,]+),(?<virtual_system_id>[^,]+),(?<factor_type>[^,]*),(?<factor_completion_time>[^,]+),(?<factor_number>[^,]+),(?<user_group_flags>[^,]+),(?<user_by_source>[^,]+),(?<tag_name>[^,]+),(?<high_resolution_timestamp>.*)\",\"regexEngine\":\"pcre2\"},\"comment\":\"PAN UserID v10\",\"id\":\"d774b426-8b11-45f5-801a-037855b67305\",\"active\":true},{\"type\":\"flatten\",\"opts\":{\"key\":\"parsed\",\"regex\":\"^.+$\",\"keyReplacement\":\"%1\",\"keepOrig\":false},\"comment\":\"\",\"id\":\"75f3e442-a251-490d-80be-d3a95a82763e\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is empty\\n        if v == '' then\\n            -- delete the key\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\\n\\n\\n\\n\\n\\n\\n\"},\"comment\":\"remove all keys that have empty values\",\"id\":\"fe010bc5-0459-4b7b-966e-a6696172bd76\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"month|day|http|log|csv|time|future_use\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"remove original event and wrapper\",\"id\":\"daf7b885-10f8-41e9-b137-2b2c2e8d8dbb\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"source\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"source\\\", \\\"src\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"destination\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"destination\\\", \\\"dest\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"virtual\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"virtual\\\", \\\"vrt\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"system\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"system\\\", \\\"sys\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"application\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"application\\\", \\\"app\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"packets\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"packets\\\", \\\"pkts\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n  \\n    return 1, ts, record\\nend\"},\"comment\":\"Rename fields that contain \\\"source\\\" to \\\"src\\\"\",\"id\":\"c1f967d7-21ff-4d09-96cb-597a9fe839c0\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"src_country|dst_country|action_flags|rule_uuid\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"\",\"id\":\"61a72d39-f5d4-4cb7-97f7-412bd4379eb7\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is \\\"0\\\"\\n        if v == \\\"0\\\" then\\n            -- delete the field\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if field value is \\\"0\\\" then remove the field\",\"id\":\"2908b07f-c20e-4853-bf2d-bfd675c45a75\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if Tunnel_Type is equal to \\\"N/A\\\"\\n    if record['tunnel_type'] == 'N/A' then\\n        -- delete Tunnel_Type\\n        record['tunnel_type'] = nil\\n        -- delete Tunnel_ID\\n        record['tunnel_id'] = nil\\n        -- delete Tunneled_app\\n        record['tunneled_app'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if Tunnel_Type has the value \\\"N/A\\\" then delete Tunnel_Type and Tunnel_ID fields\",\"id\":\"5318c192-b44f-402d-ada1-c4d52b558353\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if app_Subcategory is equal to app_Category\\n    if record['app_subcategory'] == record['app_category'] then\\n        -- delete app_Subcategory\\n        record['app_subcategory'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if app_Subcategory is equal to app_Category then delete app_Subcategory\",\"id\":\"848effb9-958b-4879-bd04-745ee0e53e00\",\"active\":true}]]====================])","call":"cb_filter"},"input":"1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.96,205.210.145.10,172.18.81.96,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,1029605,1,47776,155,2965,155,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.118-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.80.255,205.210.145.10,172.18.80.255,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,989876,1,47776,854,14801,854,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.164,205.210.145.10,172.18.81.164,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,3604346,1,47776,438,33877,438,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.137,205.210.145.10,172.18.81.137,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,518168,1,47776,378,1387,378,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.102,205.210.145.10,172.18.81.102,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,709308,1,47776,854,14454,854,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.114,205.210.145.10,172.18.81.114,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,2554426,1,47776,165,5938,165,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.84.212,205.210.145.10,172.18.84.212,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,3917668,1,47776,370,58534,370,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.88,205.210.145.10,172.18.81.88,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,3767759,1,47776,166,30884,166,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.81.57,205.210.145.10,172.18.81.57,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,2280470,1,47776,378,7750,378,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.82.42,,,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,SD-WAN,ae10.2020,ae5.255,,8/22/2024 9:08,3072293,1,47776,33333,0,0,0x19,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\n1,8/22/2024 9:08,13201031223,TRAFFIC,end,2562,8/22/2024 9:08,10.50.13.7,172.18.80.30,205.210.145.10,172.18.80.30,SPR-ALLOW-SEC-SCANNERS,subwaydai\\svc-demisto,,incomplete,vsys2,trust,untrust,ae10.2020,ae7,,8/22/2024 9:08,1172944,1,47776,843,50067,843,0x404019,tcp,allow,64,64,0,1,8/22/2024 9:08,0,any,,7.35193E+18,0x0,10.0.0.0-10.255.255.255,172.16.0.0-172.31.255.255,,1,0,aged-out,0,0,0,0,PROD_VSYS,PHL-5220-FW1-2,from-policy,,,0,,0,,N/A,0,0,0,0,842d946b-73d7-4257-a681-93a8a87c8312,0,0,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2024-08-22T09:08:33.095-04:00,,,unknown,unknown,unknown,1,,,incomplete,no,no,0\nApr 18 18:36:20 test-hostname 003001000000,2024/04/18 18:36:20,audit,2561,gui-op,Mustang,\"<show><config-locks><vsys>all</vsys></config-locks></show>\",success\nApr 18 18:37:20 test-hostname.test.intra 003001000000,2024/04/18 18:37:20,audit,2561,gui-op,Mustang,\"<show><config-locks><vsys>all</vsys></config-locks></show>\",success","isRawInput":true,"pipelineVersion":"24.10.0"}
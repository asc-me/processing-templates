{"name":"PAN-NGFW-GTP-v1","config":{"Name":"lua","match":"*","code":"cb_filter=require('calyptia.pr')([====================[[{\"type\":\"parse\",\"opts\":{\"src\":\"log\",\"dst\":\"parsed\",\"regex\":\"^(?<future_use1>[^,]*),(?<receive_time>[^,]+),(?<serial_number>[^,]+),(?<type>GTP),(?<content_type>[^,]+),(?<future_use2>[^,]*),(?<generated_time>[^,]+),(?<source_address>[^,]+),(?<destination_address>[^,]+),(?<future_use3>[^,]*),(?<future_use4>[^,]*),(?<rule_name>[^,]+),(?<future_use5>[^,]*),(?<future_use6>[^,]*),(?<application>[^,]+),(?<virtual_system>[^,]+),(?<source_zone>[^,]+),(?<destination_zone>[^,]+),(?<inbound_interface>[^,]+),(?<outbound_interface>[^,]+),(?<log_action>[^,]+),(?<future_use7>[^,]*),(?<session_id>[^,]+),(?<future_use8>[^,]*),(?<source_port>[^,]+),(?<destination_port>[^,]+),(?<future_use9>[^,]*),(?<future_use10>[^,]*),(?<future_use11>[^,]*),(?<protocol>[^,]+),(?<action>[^,]+),(?<gtp_event_type>[^,]+),(?<msisdn>[^,]+),(?<access_point_name>[^,]+),(?<radio_access_technology>[^,]+),(?<gtp_message_type>[^,]+),(?<end_user_ip_address>[^,]+),(?<tunnel_endpoint_identifier1>[^,]+),(?<tunnel_endpoint_identifier2>[^,]+),(?<gtp_interface>[^,]+),(?<gtp_cause>[^,]+),(?<severity>[^,]+),(?<serving_country_mcc>[^,]+),(?<serving_network_mnc>[^,]+),(?<area_code>[^,]+),(?<cell_id>[^,]+),(?<gtp_event_code>[^,]+),(?<future_use12>[^,]*),(?<future_use13>[^,]*),(?<source_location>[^,]+),(?<destination_location>[^,]+),(?<future_use14>[^,]*),(?<future_use15>[^,]*),(?<future_use16>[^,]*),(?<future_use17>[^,]*),(?<future_use18>[^,]*),(?<future_use19>[^,]*),(?<future_use20>[^,]*),(?<tunnel_id>[^,]*),(?<monitor_tag>[^,]+),(?<future_use21>[^,]*),(?<future_use22>[^,]*),(?<future_use23>[^,]*),(?<future_use24>[^,]*),(?<future_use25>[^,]*),(?<future_use26>[^,]*),(?<future_use27>[^,]*),(?<future_use28>[^,]*),(?<future_use29>[^,]*),(?<future_use30>[^,]*),(?<future_use31>[^,]*),(?<future_use32>[^,]*),(?<future_use33>[^,]*),(?<future_use34>[^,]*),(?<future_use35>[^,]*),(?<future_use36>[^,]*),(?<start_time>[^,]+),(?<elapsed_time>[^,]+),(?<tunnel_inspection_rule>[^,]+),(?<remote_user_ip>[^,]+),(?<remote_user_id>[^,]+),(?<uuid_for_rule>[^,]+),(?<pcap_id>[^,]+),(?<high_resolution_timestamp>[^,]+),(?<a_slice_service_type>[^,]+),(?<a_slice_differentiator>[^,]+),(?<application_subcategory>[^,]+),(?<application_category>[^,]+),(?<application_technology>[^,]+),(?<application_risk>[^,]+),(?<application_characteristic>[^,]+),(?<application_container>[^,]+),(?<application_saas>[^,]+),(?<application_sanctioned_state>.+)\",\"regexEngine\":\"pcre2\"},\"comment\":\"PAN GTP v10\",\"id\":\"65798cc7-6fb9-4217-b7b5-3e9ebc4af9f9\",\"active\":true},{\"type\":\"flatten\",\"opts\":{\"key\":\"parsed\",\"regex\":\"^.+$\",\"keyReplacement\":\"%1\",\"keepOrig\":false},\"comment\":\"\",\"id\":\"75f3e442-a251-490d-80be-d3a95a82763e\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is empty\\n        if v == '' then\\n            -- delete the key\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\\n\\n\\n\\n\\n\\n\\n\"},\"comment\":\"remove all keys that have empty values\",\"id\":\"fe010bc5-0459-4b7b-966e-a6696172bd76\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"month|day|http|log|csv|time|future_use\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"remove original event and wrapper\",\"id\":\"daf7b885-10f8-41e9-b137-2b2c2e8d8dbb\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"source\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"source\\\", \\\"src\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"destination\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"destination\\\", \\\"dest\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"virtual\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"virtual\\\", \\\"vrt\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"system\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"system\\\", \\\"sys\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"application\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"application\\\", \\\"app\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"packets\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"packets\\\", \\\"pkts\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n  \\n    return 1, ts, record\\nend\"},\"comment\":\"Rename fields that contain \\\"source\\\" to \\\"src\\\"\",\"id\":\"c1f967d7-21ff-4d09-96cb-597a9fe839c0\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"src_country|dst_country|action_flags|rule_uuid\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"\",\"id\":\"61a72d39-f5d4-4cb7-97f7-412bd4379eb7\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is \\\"0\\\"\\n        if v == \\\"0\\\" then\\n            -- delete the field\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if field value is \\\"0\\\" then remove the field\",\"id\":\"2908b07f-c20e-4853-bf2d-bfd675c45a75\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if Tunnel_Type is equal to \\\"N/A\\\"\\n    if record['tunnel_type'] == 'N/A' then\\n        -- delete Tunnel_Type\\n        record['tunnel_type'] = nil\\n        -- delete Tunnel_ID\\n        record['tunnel_id'] = nil\\n        -- delete Tunneled_app\\n        record['tunneled_app'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if Tunnel_Type has the value \\\"N/A\\\" then delete Tunnel_Type and Tunnel_ID fields\",\"id\":\"5318c192-b44f-402d-ada1-c4d52b558353\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if app_Subcategory is equal to app_Category\\n    if record['app_subcategory'] == record['app_category'] then\\n        -- delete app_Subcategory\\n        record['app_subcategory'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if app_Subcategory is equal to app_Category then delete app_Subcategory\",\"id\":\"848effb9-958b-4879-bd04-745ee0e53e00\",\"active\":true}]]====================])","call":"cb_filter"},"input":"Nov 30 16:09:08 1,2019/10/09 10:20:15,001234567890002,GTP,0,2304,2019/10/09 10:20:15,81.2.69.142,81.2.69.144,,,rule-name,,,app,v-system,s-zone,d-zone,inbound-int,outbound-int,log-action,,1212121,,9550,9551,,,,tcp,action,gtp-event,msisdn,apn,rat,gtp-msg-type,81.2.69.142,TE-Ide-1,TE-Ide-2,GTP-interface,GTP-cause,4,mcc,mnc,1010,100,GTP-event-code,,,src-loc,dst-loc,,,,,,,,imsi,imei,,,,,,,,,,,,,,,,,2021/10/26 15:35:42,9999,TI-Rule,81.2.69.142,remote-user-id,uuid,pcap-id,1970-01-01T01:00:00.000+01:00,ASST,ASD,app-sub-cat,app-cat,app-tech,4,app-char,app-container,no,no","isRawInput":true,"pipelineVersion":"24.10.0"}
{"name":"PAN-NGFW-GlobalProtect-v1","config":{"Name":"lua","match":"*","code":"cb_filter=require('calyptia.pr')([====================[[{\"type\":\"parse\",\"opts\":{\"src\":\"log\",\"dst\":\"parsed\",\"regex\":\"^(?<future_use1>[^,]+),(?<receive_time>[^,]+),(?<serial_number1>[^,]+),(?<type>GLOBALPROTECT),(?<content_type>[^,]+),(?<future_use2>[^,]+),(?<generated_time>[^,]+),(?<virtual_system>[^,]+),(?<event_id>[^,]+),(?<stage>[^,]+),(?<authentication_method>[^,]*),(?<tunnel_type>[^,]*),(?<src_user>[^,]*),(?<src_region>[^,]*),(?<machine_name>[^,]*),(?<public_ip>[^,]+),(?<public_ipv6>[^,]*),(?<private_ip>[^,]+),(?<private_ipv6>[^,]*),(?<host_id>[^,]+),(?<serial_number2>[^,]*),(?<client_version>[^,]+),(?<client_os>[^,]*),(?<client_os_version>(\\\"[^\\\\\\\"]*\\\"|[^,]*)),(?<repeat_count>[^,]*),(?<reason>[^,]*),(?<error>[^,]*),(?<description>(\\\"[^\\\\\\\"]*\\\"|[^,]*)),(?<status>[^,]+),(?<location>[^,]*),(?<login_duration>[^,]*),(?<connect_method>[^,]*),(?<error_code>[^,]*),(?<portal>[^,]+),(?<sequence_number>[^,]+),(?<unknown>.*)$\",\"regexEngine\":\"pcre2\"},\"comment\":\"PAN GlobalProtect v?\",\"id\":\"c419efa8-2872-44de-9e11-582d24ecc85e\",\"active\":true},{\"type\":\"flatten\",\"opts\":{\"key\":\"parsed\",\"regex\":\"^.+$\",\"keyReplacement\":\"%1\",\"keepOrig\":false},\"comment\":\"\",\"id\":\"75f3e442-a251-490d-80be-d3a95a82763e\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is empty\\n        if v == '' or v == '\\\\\\\"\\\\\\\"' then\\n            -- delete the key\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\\n\"},\"comment\":\"remove all keys that have empty values\",\"id\":\"fe010bc5-0459-4b7b-966e-a6696172bd76\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"month|day|http|log|csv|time|future_use\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"remove original event and wrapper\",\"id\":\"daf7b885-10f8-41e9-b137-2b2c2e8d8dbb\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"source\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"source\\\", \\\"src\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"destination\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"destination\\\", \\\"dest\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"virtual\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"virtual\\\", \\\"vrt\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"system\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"system\\\", \\\"sys\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"application\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"application\\\", \\\"app\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n    for k, v in pairs(record) do\\n        -- check if the key contains \\\"source\\\"\\n        if string.match(k, \\\"packets\\\") ~= nil then\\n            -- rename the key\\n            record[k:gsub(\\\"packets\\\", \\\"pkts\\\")] = v\\n            -- delete the old key\\n            record[k] = nil\\n        end\\n    end\\n  \\n    return 1, ts, record\\nend\"},\"comment\":\"Rename fields that contain \\\"source\\\" to \\\"src\\\"\",\"id\":\"c1f967d7-21ff-4d09-96cb-597a9fe839c0\",\"active\":true},{\"type\":\"block_keys\",\"opts\":{\"regex\":\"src_country|dst_country|action_flags|rule_uuid\",\"matchCase\":false,\"regexEngine\":\"pcre2\",\"nestedPath\":\"\"},\"comment\":\"\",\"id\":\"61a72d39-f5d4-4cb7-97f7-412bd4379eb7\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is \\\"0\\\"\\n        if v == \\\"0\\\" then\\n            -- delete the field\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if field value is \\\"0\\\" then remove the field\",\"id\":\"2908b07f-c20e-4853-bf2d-bfd675c45a75\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if Tunnel_Type is equal to \\\"N/A\\\"\\n    if record['tunnel_type'] == 'N/A' then\\n        -- delete Tunnel_Type\\n        record['tunnel_type'] = nil\\n        -- delete Tunnel_ID\\n        record['tunnel_id'] = nil\\n        -- delete Tunneled_app\\n        record['tunneled_app'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if Tunnel_Type has the value \\\"N/A\\\" then delete Tunnel_Type and Tunnel_ID fields\",\"id\":\"5318c192-b44f-402d-ada1-c4d52b558353\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    -- check if app_Subcategory is equal to app_Category\\n    if record['app_subcategory'] == record['app_category'] then\\n        -- delete app_Subcategory\\n        record['app_subcategory'] = nil\\n    end\\n    return 1, ts, record\\nend\"},\"comment\":\"if app_Subcategory is equal to app_Category then delete app_Subcategory\",\"id\":\"848effb9-958b-4879-bd04-745ee0e53e00\",\"active\":true},{\"type\":\"replace\",\"opts\":{\"key\":\"client_os_version\",\"regex\":\"\\\\\\\"([^,]+),([^\\\\\\\"]+)\\\\\\\"\",\"matchCase\":false,\"replacement\":\"%1-%2\",\"regexEngine\":\"pcre2\"},\"comment\":\"clean OS version field format\",\"id\":\"2f9c40ee-90de-4b24-8d4a-c319a9ed6d65\",\"active\":true},{\"type\":\"custom_script\",\"opts\":{\"script\":\"return function(tag, ts, record)\\n    for k, v in pairs(record) do\\n        -- check if the value is empty\\n        if v == '0.0.0.0' then\\n            -- delete the key\\n            record[k] = nil\\n        end\\n    end\\n    return 1, ts, record\\nend\\n\"},\"comment\":\"delete any IP field with the value 0.0.0.0\",\"id\":\"55743a9c-5f70-402f-854f-3fc37920708d\",\"active\":true}]]====================])","call":"cb_filter"},"input":"Nov 30 16:09:08 1,2021/03/24 11:30:00,013101001305,GLOBALPROTECT,0,2305,2021/03/24 11:30:00,vsys1,portal-prelogin,before-login,,,,BE,,216.160.83.57,0.0.0.0,81.2.69.193,0.0.0.0,09300aaa-23-4900-8aa9-32695452aa,,5.2.4,OS,\"OS 10 Pro , 64-bit\",1,,,\"\",success,,0,,0,GlobalProtect Portal,69200719497738,0x0\nNov 30 16:09:08 1,2021/03/24 11:29:49,013101001308,GLOBALPROTECT,0,2305,2021/03/24 11:29:49,vsys1,gateway-config-release,configuration,,,domain\\user,BE,CP935,89.160.20.112,0.0.0.0,10.20.13.217,0.0.0.0,e0957c11-93-437a-9e23-9f0c24059898,5J9VN53,5.2.4,OS,\"OS 10 Pro , 64-bit\",1,,,\"\",success,,0,,0,GlobalProtect_GW,6919501582016786,0x0\nNov 30 16:09:08 1,2021/04/07 17:41:30,013101305,GLOBALPROTECT,0,2305,2021/04/07 17:41:30,vsys1,gateway-hip-check,host-info,,,domain\\user1,,HOST82878,1.128.3.4,0.0.0.0,67.43.156.14,0.0.0.0,523e8b-7efa-4397-a4d5-824dfa4d8a,F1SM2,5.2.4,,\"\",1,,,\"HIP report is not needed\",success,,0,,0,GlobalProtect_GW,6920071768563516860,0x0\nNov 30 16:09:08 1,2021/04/07 17:41:29,013101308,GLOBALPROTECT,0,2305,2021/04/07 17:41:29,vsys1,gateway-getconfig,configuration,,IPSec,pre-logon,BE,HOST73486,81.2.69.193,0.0.0.0,89.160.20.112,0.0.0.0,7d01b5-f538-4fa3-a2a2-83980d1325,5C261FNR,5.2.4,OS,\"OS 10 Pro , 64-bit\",1,,,\"Config name: , Client region: BE.\",success,,0,,0,GlobalProtect_GW,6944137135219737,0x0\nNov 30 16:09:08 1,2021/04/07 17:41:28,0131001309,GLOBALPROTECT,0,2305,2021/04/07 17:41:28,vsys1,gateway-tunnel-latency,tunnel,,,,userlterso,HOSTP92413,81.2.69.143,0.0.0.0,0.0.0.0,0.0.0.0,2ba9f01-b83b-4902-a1fb-1748c0365,GJG98Y2,5.2.4,,\"\",1,,,\"Pre-tunnel latency: 67ms, Post-tunnel latency: 47ms\",success,,0,,0,GlobalProtect_GW,6920071768563516847,0x0","isRawInput":true,"pipelineVersion":"24.10.0"}